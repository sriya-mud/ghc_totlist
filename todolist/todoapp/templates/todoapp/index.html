

{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>To-Do & Finance Returns</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!--link rel="stylesheet" href="{% static 'style.css' %}"-->
  <style>
      body {
          background-color: #f0f2f5;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      .container {
          max-width: 950px;
          margin-top: 50px;
          background: white;
          padding: 30px;
          border-radius: 15px;
          box-shadow: 0 4px 15px rgba(0,0,0,0.1);
          display:flex;
          flex-direction: column;
        
      }

      h2 {
          font-weight: 700;
          margin-bottom: 25px;
      }

      /* Navbar Tabs */
      .nav-tabs .nav-link {
          font-weight: bold;
          color: #495057;
          border: none;
          border-bottom: 3px solid transparent;
          transition: all 0.3s;
      }
      .nav-tabs .nav-link.active {
          border-bottom: 3px solid #007bff;
          color: #007bff;
      }

      /* To-Do Inputs */
      .todo-input {
          width: 200px;
          margin-right: 10px;
          border-radius: 8px;
          border: 1px solid #ced4da;
          padding: 6px 10px;
      }
      .btn-primary {
          border-radius: 8px;
          padding: 6px 20px;
          font-weight: 600;
      }

      /* Update/Delete buttons */
      .btn-update {
          background-color: #28a745;
          color: white;
          border-radius: 6px;
      }
      .btn-update:hover { background-color: #218838; color: white; }
      .btn-delete {
          background-color: #dc3545;
          color: white;
          border-radius: 6px;
      }
      .btn-delete:hover { background-color: #c82333; color: white; }

      /* Finance Tables */
      table.finance-table {
          border-collapse: collapse;
          margin-bottom: 30px;
          width: 100%;
      }
      table.finance-table th, table.finance-table td {
          border: 1px solid #dee2e6;
          padding: 12px;
          text-align: center;
      }
      table.finance-table th {
          background-color: #e9ecef;
          font-weight: 600;
      }
      .finance-table td.positive {
          color: #198754;
          font-weight: bold;
      }
      .finance-table td.negative {
          color: #dc3545;
          font-weight: bold;
      }
  </style>
</head>
<body>
<div class="container">
    <h2 style="text-align:center;"> To-Do & Finance Dashboard</h2>

    <!-- Navbar -->
    <ul class="nav nav-tabs mb-4" id="dashboardTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="todo-tab" data-bs-toggle="tab" data-bs-target="#todo" type="button" role="tab">To-Do List</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="finance-tab" data-bs-toggle="tab" data-bs-target="#finance" type="button" role="tab">Finance Returns</button>
        </li>
        <li class="nav-item" role="presentation">
        <button class="nav-link" id="data-tab" data-bs-toggle="tab" data-bs-target="#data" type="button" role="tab">Data Analysis</button>
        </li>
    </ul>

    <div class="tab-content">
        <!-- To-Do List Tab -->
        <div class="tab-pane fade show active" id="todo" role="tabpanel">
            <!-- Add Task Form -->
            <form method="POST" class="d-flex justify-content-start mb-4">
                {% csrf_token %}
                {{ form.task }}
                {{ form.date }}
                <button type="submit" class="btn btn-primary">Add Task</button>
            </form>

            <!-- Tasks Table -->
            <table class="table table-bordered align-middle">
                <thead class="table-light">
                    <tr>
                        <th>No.</th>
                        <th>Todo Item</th>
                        <th>Date</th>
                        <th>Update</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in tasks %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ t.task }}</td>
                        <td>{{ t.date }}</td>
                        <td><a href="{% url 'update_task' t.id %}" class="btn btn-update btn-sm">Update</a></td>
                        <td><a href="{% url 'delete_task' t.id %}" class="btn btn-delete btn-sm">Delete</a></td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="5">No tasks yet.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Finance Returns Tab -->
        <div class="tab-pane fade" id="finance" role="tabpanel">
            {% for period, result in stock_data.items %}
                <h4 class="mt-4">{{ period }}</h4>
                <table class="finance-table table table-striped">
            <thead>
                <tr>
                    <th colspan="2">Top Gainers</th>
                    <th colspan="2">Top Losers</th>
                </tr>
                <tr>
                    <th>Ticker</th>
                    <th>Value (%)</th>
                    <th>Ticker</th>
                    <th>Value (%)</th>
                </tr>
            </thead>
                    <tbody>
                     {% for g, l in result.gainers_losers %}
                        <tr>
                            <!--Top gainers-->
                            {% if g %}
                            <td>{{ g.0 }}</td>
                            <td class="{% if g.1 >= 0 %}positive{% else %}negative{% endif %}">{{ g.1|floatformat:2 }}%</td>
                             {% else %}
                                <td></td><td></td>
                            {% endif %}
                            <!--Top losers-->
                            {% if l %}
                            <td>{{ l.0 }}</td>
                            <td class="{% if l.1 >= 0 %}positive{% else %}negative{% endif %}">{{ l.1|floatformat:2 }}%</td>
                            {% else %}
                                <td></td><td></td>
                            {% endif %}
                        </tr>
                      {% endfor %}
                    </tbody>

                </table>
            {% endfor %}
        </div>
    </div>
</div>

<!--Data analysis tab-->

<div class="tab-pane fade" id="data" role="tabpanel">
            <!--h3 style="text-align:center;"> Data Analysis</h3-->
            <!--p class="text-muted">Charts generated automatically from <code>data.csv</code>.</p-->

           <!-- Dropdown -->
    <select id="taskSelect" class="form-select w-25 mb-3">
        <option value="" selected disabled>Select Task</option>
        <option value="task1">Task 1</option>
        <option value="task2">Task 2</option>
        <option value="task3">Task 3</option>
    </select>

    <!-- Table -->
    <div id="taskTableContainer"></div>

    <!-- Chart -->
    <canvas id="taskChart" height="150"></canvas>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const taskData = JSON.parse(document.getElementById('taskDataJSON').textContent);;
let chartInstance = null;

document.getElementById('taskSelect').addEventListener('change', function() {
    const task = this.value;
    const tableContainer = document.getElementById('taskTableContainer');

    // Clear previous table
    tableContainer.innerHTML = "";

    let tableHTML = "<table class='table table-striped'><thead><tr>";

    if(task === 'task1' || task === 'task2') {
        tableHTML += "<th>Category</th><th>Value</th></tr></thead><tbody>";
        taskData[task].labels.forEach((label, i) => {
            tableHTML += `<tr><td>${label}</td><td>${taskData[task].values[i]}</td></tr>`;
        });
        tableHTML += "</tbody></table>";
        tableContainer.innerHTML = tableHTML;

        // Chart
        const type = task === 'task1' ? 'line' : 'bar';
        const data = {
            labels: taskData[task].labels,
            datasets: [{
                label: task,
                data: taskData[task].values,
                backgroundColor: task === 'task2' ? 'green' : 'rgba(0,0,255,0.2)',
                borderColor: task === 'task1' ? 'blue' : undefined,
                fill: task === 'task1'
            }]
        };

        if(chartInstance) chartInstance.destroy();
        chartInstance = new Chart(document.getElementById('taskChart'), { type, data });

    } else if(task === 'task3') {
        tableHTML += "<th>X</th><th>Y</th></tr></thead><tbody>";
        taskData.task3.points.forEach(pt => {
            tableHTML += `<tr><td>${pt.x}</td><td>${pt.y}</td></tr>`;
        });
        tableHTML += "</tbody></table>";
        tableContainer.innerHTML = tableHTML;

        // Scatter chart
        const data = {
            datasets: [{
                label: 'Task 3',
                data: taskData.task3.points,
                backgroundColor: 'red'
            }]
        };

        if(chartInstance) chartInstance.destroy();
        chartInstance = new Chart(document.getElementById('taskChart'), {
            type: 'scatter',
            data,
            options: {
                scales: {
                    x: { title: { display: true, text: 'X Axis' } },
                    y: { title: { display: true, text: 'Y Axis' } }
                }
            }
        });
    }
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

